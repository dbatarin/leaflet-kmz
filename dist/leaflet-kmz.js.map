{"version":3,"file":"leaflet-kmz.js","sources":["../src/KMZParser.js","../src/KMZLoader.js","../src/GridLayer.GeoJSON.js"],"sourcesContent":["L.KMZParser = L.Class.extend({\n\n  initialize: function(opts) {\n    L.setOptions(this, opts);\n    this.loaders = [];\n  },\n\n  load: function(kmzUrl, opts) {\n    var kmzLoader = new L.KMZLoader(L.extend({}, this.options, opts));\n    kmzLoader.parse(kmzUrl);\n    this.loaders.push(kmzLoader);\n  },\n\n  get: function(i) {\n    return i < this.loaders.length ? this.loaders[i] : false;\n  },\n});\n\nexport var KMZParser = L.KMZParser;\n","import JSZip from 'jszip';\nimport geojsonvt from 'geojson-vt';\nimport * as toGeoJSON from '@tmcw/togeojson';\n\nL.KMZLoader = L.Class.extend({\n  options: {\n    tiled: true,\n    interactive: true,\n    ballon: true,\n    bindPopup: true,\n    bindTooltip: true,\n    bindLabel: true,\n    labelClassname: null,\n    debug: 0,\n    mapInstance: null,\n  },\n\n  initialize: function(opts) {\n    L.setOptions(this, opts);\n    // Optimized GeoJSON Vector Tiles through \"geojson-vt.js\" library.\n    this.tiled = ('geojsonvt' in window || geojsonvt) && this.options.tiled;\n    // Standard Mouse interactions through default \"leaflet.js\" layers.\n    this.interactive = this.options.interactive;\n    // (Experimental) Optimized Mouse interactions through \"geojson-vt.js\" and \"leaflet-pointable.js\" libraries.\n    this.pointable = this.tiled && !this.options.interactive && this.options.pointable;\n    this.emptyIcon = 'data:image/png;base64,' + \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAFElEQVR4XgXAAQ0AAABAMP1L30IDCPwC/o5WcS4AAAAASUVORK5CYII=\";\n    this.name = this.options.name;\n    this.callback = opts.onKMZLoaded;\n  },\n\n  parse: function(kmzUrl) {\n    this.name = this.name ? this.name : kmzUrl.split('/').pop();\n    this._load(kmzUrl);\n  },\n\n  _load: function(url) {\n    this._getBinaryContent(url, function(err, data) {\n      if (err != null) console.error(url, err, data);\n      else this._parse(data);\n    }.bind(this));\n  },\n\n  _parse: function(data) {\n    return this._isZipped(data) ? this._parseKMZ(data) : this._parseKML(data);\n  },\n\n  _parseKMZ: function(data) {\n    var that = this;\n    JSZip.loadAsync(data).then((zip) => {\n      Promise.all(that._mapZipFiles(zip)).then((list) => {\n        Promise.all(that._mapListFiles(list)).then((data) => {\n          var kmlString = this._decodeKMZFolder(data);\n          that._parseKML(kmlString);\n        });\n      });\n    });\n  },\n\n  _parseKML: function(data) {\n    var kmlString = this._decodeKMLString(data);\n    var xmlDoc = this._toXML(kmlString);\n    this._kmlToLayer(xmlDoc);\n  },\n\n  _decodeKMLString: function(data) {\n    return data instanceof ArrayBuffer ? String.fromCharCode.apply(null, new Uint8Array(data)) : data;\n  },\n\n  _decodeKMZFolder: function(data) {\n    var kmzFiles = this._listToObject(data);\n    var kmlDoc = this._getKmlDoc(kmzFiles);\n    var images = this._getImageFiles(Object.keys(kmzFiles));\n\n    var kmlString = kmzFiles[kmlDoc];\n\n    // replaces all images with their base64 encoding\n    for (var i in images) {\n      var imageUrl = images[i];\n      var dataUrl = kmzFiles[imageUrl];\n      kmlString = this._replaceAll(kmlString, imageUrl, dataUrl);\n    }\n    return kmlString;\n  },\n\n  _toXML: function(text) {\n    return (new DOMParser()).parseFromString(text, 'text/xml');\n  },\n\n  _toGeoJSON: function(xmlDoc) {\n    return (toGeoJSON || window.toGeoJSON).kml(xmlDoc);\n  },\n\n  _kmlToLayer: function(xmlDoc) {\n    var data = this._toGeoJSON(xmlDoc);\n\n    if (this.interactive) {\n      this.geojson = L.geoJson(data, {\n        pointToLayer: this._pointToLayer.bind(this),\n        onEachFeature: this._onEachFeature.bind(this),\n      });\n      this.layer = this.geojson;\n    }\n\n    if (this.tiled) {\n      this.gridlayer = L.gridLayer.geoJson(data, {\n        pointable: this.pointable,\n        ballon: this.options.ballon,\n        bindPopup: this.options.bindPopup,\n        bindTooltip: this.options.bindTooltip,\n      });\n      this.layer = this.interactive ? L.featureGroup([this.gridlayer, this.geojson]) : this.gridlayer;\n    }\n\n    if (this.layer) {\n      this._onKMZLoaded(this.layer, this.name);\n    }\n  },\n\n  _pointToLayer: function(feature, latlng) {\n    return new L.marker(latlng, {\n      icon: L.icon({\n        iconUrl: this.emptyIcon,\n      }),\n    });\n  },\n\n  _onEachFeature: function(feature, layer) {\n    switch (feature.geometry.type) {\n      case 'Point':\n        this._setLayerPointIcon(feature, layer);\n        break;\n      case 'LineString':\n      case 'Polygon':\n      case 'GeometryCollection':\n        this._setLayerStyle(feature, layer);\n        break;\n      default:\n        console.warn('Unsupported feature type: ' + feature.geometry.type, feature);\n        break;\n    }\n    this._setLayerBalloon(feature, layer);\n    this._setFeatureLabel(feature, layer);\n  },\n\n  _onKMZLoaded: function(layer, name) {\n    if (this.options.debug) console.log(layer, name);\n    if (this.callback) this.callback(layer, name);\n  },\n\n  _setFeatureLabel: function(feature, layer) {\n    if(this.options.bindLabel) {\n      var name = feature.properties.name ? feature.properties.name : \"\";\n\n      layer.setIcon && layer.setIcon(L.divIcon({ \n        className: this.options.labelClassname ? this.options.labelClassname : \"feature-label\",\n        html: name,\n      }));\n    }\n  },\n\n  _setLayerPointIcon: function(feature, layer) {\n    var width = 28;\n    var height = 28;\n    layer.setIcon(L.icon({\n      iconSize: [width, height],\n      iconAnchor: [width / 2, height / 2],\n      iconUrl: this.tiled ? this.emptyIcon : feature.properties.icon,\n    }));\n  },\n\n  _setLayerStyle: function(feature, layer) {\n    var styles = {\n      weight: 1,\n      opacity: 0,\n      fillOpacity: 0,\n    };\n    if (!this.tiled) {\n      if (feature.properties[\"stroke-width\"]) {\n        styles.weight = feature.properties[\"stroke-width\"] * 1.05;\n      }\n      if (feature.properties[\"stroke-opacity\"]) {\n        styles.opacity = feature.properties[\"stroke-opacity\"];\n      }\n      if (feature.properties[\"fill-opacity\"]) {\n        styles.fillOpacity = feature.properties[\"fill-opacity\"];\n      }\n      if (feature.properties.stroke) {\n        styles.color = feature.properties.stroke;\n      }\n      if (feature.properties.fill) {\n        styles.fillColor = feature.properties.fill;\n      }\n    }\n    layer.setStyle(styles);\n  },\n\n  _setLayerBalloon: function(feature, layer) {\n    if (!this.options.ballon) return;\n\n    var name = feature.properties.name ? feature.properties.name : \"\";\n    var desc = feature.properties.description ? feature.properties.description : \"\";\n\n    if (name || desc) {\n      if (this.options.bindPopup) {\n        layer.bindPopup('<div>' + '<b>' + name + '</b>' + '<br>' + desc + '</div>');\n      }\n      // if (this.options.bindTooltip) {\n      //   layer.bindTooltip('<b>' + name + '</b>', {\n      //     direction: 'left',\n      //     sticky: true,\n      //     permanent: true, \n      //     className: \"tooltip-label\", \n      //     offset: [0, 0]\n      //   });\n      // }\n    }\n  },\n\n  _escapeRegExp: function(str) {\n    return str.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n  },\n\n  _replaceAll: function(str, find, replace) {\n    return str.replace(new RegExp(this._escapeRegExp(find), 'g'), replace);\n  },\n\n  _mapZipFiles: function(zip) {\n    return Object.keys(zip.files)\n      .map((name) => zip.files[name])\n      .map((entry) => entry\n        .async(\"blob\")\n        .then((value) => [entry.name, value]) // [ fileName, stringValue ]\n      );\n  },\n\n  _mapListFiles: function(list) {\n    return list.map(file => Promise.resolve().then(() => {\n      return this._readFile(file);\n    }));\n  },\n\n  _listToObject: function(list) {\n    return list\n      .reduce(function(newObj, listElem) {\n        newObj[listElem[0]] = listElem[1]; // { fileName: stringValue }\n        return newObj;\n      }, {} /* NB: do not remove, initial value */ );\n  },\n\n  _getFileExt: function(filename) {\n    return filename.split('.').pop().toLowerCase().replace('jpg', 'jpeg');\n  },\n\n  _getMimeType: function(filename, ext) {\n    var mime = 'text/plain';\n    if (/\\.(jpe?g|png|gif|bmp)$/i.test(filename)) {\n      mime = 'image/' + ext;\n    } else if (/\\.kml$/i.test(filename)) {\n      mime = 'text/plain';\n    }\n    return mime;\n  },\n\n  _getKmlDoc: function(files) {\n    return files[\"doc.kml\"] ? \"doc.kml\" : this._getKmlFiles(Object.keys(files))[0];\n  },\n\n  _getKmlFiles: function(files) {\n    return files.filter((file) => /.*\\.kml/.test(file));\n  },\n\n  _getImageFiles: function(files) {\n    return files.filter((file) => /\\.(jpe?g|png|gif|bmp)$/i.test(file));\n  },\n\n  /**\n   * It checks if a given file begins with PK, if so it's zipped\n   *\n   * @link https://en.wikipedia.org/wiki/List_of_file_signatures\n   */\n  _isZipped: function(file) {\n    var P = new Uint8Array(file, 0, 1); // offset, length\n    var K = new Uint8Array(file, 1, 1);\n    var PK = String.fromCharCode(P, K);\n    return 'PK' === PK;\n  },\n\n  _readFile: function(file) {\n    var filename = file[0];\n    var fileblob = file[1];\n    var ext = this._getFileExt(filename);\n    var mime = this._getMimeType(filename, ext);\n    return this._fileReader(fileblob, mime, filename);\n  },\n\n  _fileReader: function(blob, mime, name) {\n    return new Promise((resolve, reject) => {\n      var fr = new FileReader();\n      fr.onload = () => {\n        var result = fr.result;\n        if (mime.indexOf('text') === -1) {\n          var dataUrl = fr.result;\n          var base64 = dataUrl.split(',')[1];\n          result = 'data:' + mime + ';base64,' + base64;\n        }\n        return resolve([\n          name, result\n        ]);\n      };\n      if (mime.indexOf('text') === -1) {\n        fr.readAsDataURL(blob);\n      } else {\n        fr.readAsText(blob);\n      }\n    });\n  },\n\n  _getBinaryContent: function(path, callback) {\n    try {\n      var xhr = new window.XMLHttpRequest();\n      xhr.open('GET', path, true);\n      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n      xhr.responseType = \"arraybuffer\";\n      xhr.onreadystatechange = function(evt) {\n        var file, err;\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200 || xhr.status === 0) {\n            file = null;\n            err = null;\n            try {\n              file = xhr.response || xhr.responseText;\n            } catch (e) {\n              err = new Error(e);\n            }\n            callback(err, file);\n          } else {\n            callback(new Error(\"Ajax error for \" + path + \" : \" + this.status + \" \" + this.statusText), null);\n          }\n        }\n      };\n      xhr.send();\n    } catch (e) {\n      callback(new Error(e), null);\n    }\n  },\n\n  _blobToString: function(b) {\n    var u, x;\n    u = URL.createObjectURL(b);\n    x = new XMLHttpRequest();\n    x.open('GET', u, false); // although sync, you're not fetching over internet\n    x.send();\n    URL.revokeObjectURL(u);\n    return x.responseText;\n  },\n\n  _blobToBase64: function(blob, callback) {\n    var reader = new FileReader();\n    reader.onload = function() {\n      var dataUrl = reader.result;\n      var base64 = dataUrl.split(',')[1];\n      callback(base64);\n    };\n    reader.readAsDataURL(blob);\n  },\n\n});\n\nexport var KMZLoader = L.KMZLoader;\n","/**\n * A plugin combining geojson-vt with leafletjs which is initially inspired by leaflet-geojson-vt.\n *\n * @author Brandonxiang, Raruto\n *\n * @link https://github.com/brandonxiang/leaflet-geojson-vt\n */\n\nimport geojsonvt from 'geojson-vt';\nimport 'leaflet-pointable';\n\nL.GridLayer.GeoJSON = L.GridLayer.extend({\n  options: {\n    pointable: false,\n    ballon: false,\n    bindPopup: false,\n    bindTooltip: false,\n    async: false,\n    maxZoom: 24,\n    tolerance: 3,\n    debug: 0,\n    extent: 4096,\n    buffer: 256,\n    icon: {\n      width: 28,\n      height: 28\n    },\n    styles: {\n      strokeWidth: 1,\n      strokeColor: '#f00',\n      strokeOpacity: 1.0,\n      fillColor: '#000',\n      fillOpacity: 0.25\n    }\n  },\n\n  initialize: function(geojson, options) {\n    L.setOptions(this, options);\n    L.GridLayer.prototype.initialize.call(this, options);\n    this.tileIndex = (geojsonvt || window.geojsonvt)(geojson, this.options);\n    this.geojson = geojson; // eg. saved for advanced \"leaflet-pip\" mouse/click integrations\n  },\n\n  onAdd: function(map) {\n    L.GridLayer.prototype.onAdd.call(this, map);\n    if (this.options.ballon) {\n      if (this.options.bindPopup) this._map.on(\"click\", this.updateBalloon, this);\n      if (this.options.bindTooltip) this._map.on(\"mousemove\", this.updateBalloon, this);\n    }\n  },\n\n  createTile: function(coords) {\n    var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n    var size = this.getTileSize();\n    tile.width = size.x;\n    tile.height = size.y;\n    var ctx = tile.getContext('2d');\n\n    // return the tile so it can be rendered on screen\n    var tileInfo = this.tileIndex.getTile(coords.z, coords.x, coords.y);\n    var features = tileInfo ? tileInfo.features : [];\n    for (var i = 0; i < features.length; i++) {\n      this._drawFeature(ctx, features[i]);\n    }\n    return tile;\n  },\n\n  _drawFeature: function(ctx, feature) {\n    ctx.beginPath();\n    this._setStyle(ctx, feature);\n\n    if (feature.type === 1) this._drawIcon(ctx, feature);\n    else if (feature.type === 2) this._drawLine(ctx, feature);\n    else if (feature.type === 3) this._drawPolygon(ctx, feature);\n    else console.warn('Unsupported feature type: ' + feature.geometry.type, feature);\n\n    ctx.stroke();\n  },\n\n  _drawIcon: function(ctx, feature) {\n    var icon = new Image(),\n      p = feature.geometry[0],\n      width = this.options.icon.width,\n      height = this.options.icon.height;\n    icon.onload = function() {\n      ctx.drawImage(icon, (p[0] / 16.0) - (width / 2.0), (p[1] / 16.0) - (height / 2.0), width, height);\n    };\n    icon.src = feature.tags.icon ? feature.tags.icon : null;\n  },\n\n  _drawLine: function(ctx, feature) {\n    for (var j = 0; j < feature.geometry.length; j++) {\n      var ring = feature.geometry[j];\n      for (var k = 0; k < ring.length; k++) {\n        var p = ring[k];\n        if (k) ctx.lineTo(p[0] / 16.0, p[1] / 16.0);\n        else ctx.moveTo(p[0] / 16.0, p[1] / 16.0);\n      }\n    }\n  },\n\n  _drawPolygon: function(ctx, feature) {\n    this._drawLine(ctx, feature);\n    ctx.fill('evenodd');\n  },\n\n  _setStyle: function(ctx, feature) {\n    var style = {};\n\n    if (feature.type === 1) style = this._setPointStyle(feature, style);\n    else if (feature.type === 2) style = this._setLineStyle(feature, style);\n    else if (feature.type === 3) style = this._setPolygonStyle(feature, style);\n\n    ctx.lineWidth = style.stroke ? this._setWeight(style.weight) : 0;\n    ctx.strokeStyle = style.stroke ? this._setOpacity(style.stroke, style.opacity) : {};\n    ctx.fillStyle = style.fill ? this._setOpacity(style.fill, style.fillOpacity) : {};\n  },\n\n  _setPointStyle: function(feature, style) {\n    return style;\n  },\n\n  _setLineStyle: function(feature, style) {\n    style.weight = (feature.tags[\"stroke-width\"] ? feature.tags[\"stroke-width\"] : this.options.styles.strokeWidth) * 1.05;\n    style.opacity = feature.tags[\"stroke-opacity\"] ? feature.tags[\"stroke-opacity\"] : this.options.styles.strokeOpacity;\n    style.stroke = feature.tags.stroke ? feature.tags.stroke : this.options.styles.strokeColor;\n    return style;\n  },\n\n  _setPolygonStyle: function(feature, style) {\n    style = this._setLineStyle(feature, style);\n    style.fill = feature.tags.fill ? feature.tags.fill : this.options.styles.fillColor;\n    style.fillOpacity = feature.tags[\"fill-opacity\"] ? feature.tags[\"fill-opacity\"] : this.options.styles.fillOpacity;\n    return style;\n  },\n\n  _setWeight: function(weight) {\n    return weight || 5;\n  },\n\n  _setOpacity: function(color, opacity) {\n    color = color || '#f00';\n    if (opacity && this._iscolorHex(color)) {\n      var colorRgb = this._colorRgb(color);\n      return \"rgba(\" + colorRgb[0] + \",\" + colorRgb[1] + \",\" + colorRgb[2] + \",\" + opacity + \")\";\n    }\n    return color;\n  },\n\n  _iscolorHex: function(color) {\n    return /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(color.toLowerCase());\n  },\n\n  _colorRgb: function(color) {\n    var sColor = color.toLowerCase();\n    if (sColor.length === 4) {\n      var sColorNew = \"#\";\n      for (var i = 1; i < 4; i += 1) {\n        sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));\n      }\n      sColor = sColorNew;\n    }\n    var sColorChange = [];\n    for (var j = 1; j < 7; j += 2) {\n      sColorChange.push(parseInt(\"0x\" + sColor.slice(j, j + 2)));\n    }\n    return sColorChange;\n  },\n\n  /**\n   * Point in Polygon: ray-casting algorithm\n   *\n   * @link http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\n   */\n  _pointInPolygon: function(point, vs) {\n    var x = point[0];\n    var y = point[1];\n\n    var inside = false;\n    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {\n      var xi = vs[i][0];\n      var yi = vs[i][1];\n      var xj = vs[j][0];\n      var yj = vs[j][1];\n\n      var intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n      if (intersect) inside = !inside;\n    }\n\n    return inside;\n  },\n\n  _getLatLngsPoly: function(feature, i) {\n    var o = [];\n    var geometry = feature.geometry || feature;\n    var coords = geometry.type == \"Polygon\" ? geometry.coordinates[0] : geometry.coordinates;\n    for (var j = i || 0; j < coords.length; j++) {\n      o[i++] = [coords[j][0], coords[j][1]];\n    }\n    return o.length ? o : false;\n  },\n\n  _getLatLngsPoint: function(feature, i) {\n    var o = [];\n    var geometry = feature.geometry || feature;\n    var coords = geometry.coordinates;\n    o[i || 0] = [coords[0], coords[1]];\n    return o.length ? o : false;\n  },\n\n  _getLatLngs: function(feature, i) {\n    var o = [];\n    i = i || 0;\n    var coords;\n\n    var geometry = feature.geometry || feature;\n    var type = geometry.type;\n\n    if (type == \"Point\") {\n      coords = this._getLatLngsPoint(feature, i);\n      if (coords) Array.prototype.push.apply(o, coords);\n    } else if (type == \"LineString\" || type == \"Polygon\") {\n      coords = this._getLatLngsPoly(feature, i);\n      if (coords) Array.prototype.push.apply(o, coords);\n    } else if (type == \"GeometryCollection\") {\n      var polys = geometry.geometries;\n      for (var j = 0; j < polys.length; j++) {\n        coords = this._getLatLngs(polys[j], i);\n        if (coords) Array.prototype.push.apply(o, coords);\n      }\n    } else {\n      console.warn(\"Unsupported feature type: \" + type);\n    }\n    return o.length ? o : false;\n  },\n\n  /**\n   * (EXPERIMENTAL) Based on: https://github.com/mapbox/leaflet-pip\n   *\n   * TODO: add/check support for Points, Lines and \"donuts\" Polygons\n   */\n  pointInLayer: function(p, layer, first) {\n    if (p instanceof L.LatLng) p = [p.lng, p.lat];\n    var results = [];\n\n    layer = layer || this.geojson;\n    first = first || true;\n    var features = layer.features;\n\n    for (var i = 0; i < features.length; i++) {\n      if (first && results.length) break;\n      var coords = this._getLatLngs(features[i]);\n      if (coords) {\n        var inside = this._pointInPolygon(p, coords); // NB. works only with polygons (see: https://observablehq.com/@tmcw/understanding-point-in-polygon).\n        if (inside) results.push(features[i]);\n      }\n    }\n    return results.length ? results : false;\n  },\n\n  /**\n   * (EXPERIMENTAL) Based on: https://github.com/Raruto/leaflet-pointable\n   */\n  updateBalloon: function(e) {\n    if (!this._map || !this.options.pointable || !this._map.isPointablePixel() || !this.isPointablePixel()) return;\n    this._popup = this._popup || new L.Popup();\n    var points = this.pointInLayer(e.latlng, this.geojson);\n    if (points) {\n      var feature = points[0];\n      var name = feature.properties.name || \"\";\n      if (name) {\n        this._popup.setLatLng(e.latlng);\n        this._popup.setContent('<b>' + name + '</b>');\n        this._popup.openOn(this._map);\n      }\n    } else {\n      this._map.closePopup(this._popup);\n    }\n  },\n\n});\n\nL.gridLayer.geoJson = function(geojson, options) {\n  return new L.GridLayer.GeoJSON(geojson, options);\n};\n\nexport var GridLayer = {\n  GeoJSON: L.GridLayer.GeoJSON,\n};\n\nexport var gridLayer = {\n  geoJSON: L.gridLayer.geoJson,\n};\n"],"names":["L","KMZParser","Class","extend","initialize","opts","setOptions","this","loaders","load","kmzUrl","kmzLoader","KMZLoader","options","parse","push","get","i","length","tiled","interactive","ballon","bindPopup","bindTooltip","bindLabel","labelClassname","debug","mapInstance","window","geojsonvt","pointable","emptyIcon","name","callback","onKMZLoaded","split","pop","_load","url","_getBinaryContent","err","data","console","error","_parse","bind","_isZipped","_parseKMZ","_parseKML","that","JSZip","loadAsync","then","zip","Promise","all","_mapZipFiles","list","_mapListFiles","kmlString","_decodeKMZFolder","_decodeKMLString","xmlDoc","_toXML","_kmlToLayer","ArrayBuffer","String","fromCharCode","apply","Uint8Array","kmzFiles","_listToObject","kmlDoc","_getKmlDoc","images","_getImageFiles","Object","keys","imageUrl","dataUrl","_replaceAll","text","DOMParser","parseFromString","_toGeoJSON","toGeoJSON","kml","geojson","geoJson","pointToLayer","_pointToLayer","onEachFeature","_onEachFeature","layer","gridlayer","gridLayer","featureGroup","_onKMZLoaded","feature","latlng","marker","icon","iconUrl","geometry","type","_setLayerPointIcon","_setLayerStyle","warn","_setLayerBalloon","_setFeatureLabel","log","properties","setIcon","divIcon","className","html","iconSize","iconAnchor","width","height","styles","weight","opacity","fillOpacity","stroke","color","fill","fillColor","setStyle","desc","description","_escapeRegExp","str","replace","find","RegExp","files","map","entry","async","value","file","resolve","_readFile","reduce","newObj","listElem","_getFileExt","filename","toLowerCase","_getMimeType","ext","mime","test","_getKmlFiles","filter","P","K","fileblob","_fileReader","blob","reject","fr","FileReader","onload","result","indexOf","base64","readAsDataURL","readAsText","path","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onreadystatechange","evt","readyState","status","response","responseText","e","Error","statusText","send","_blobToString","b","u","x","URL","createObjectURL","revokeObjectURL","_blobToBase64","reader","GridLayer","GeoJSON","maxZoom","tolerance","extent","buffer","strokeWidth","strokeColor","strokeOpacity","prototype","call","tileIndex","onAdd","_map","on","updateBalloon","createTile","coords","tile","DomUtil","create","size","getTileSize","y","ctx","getContext","tileInfo","getTile","z","features","_drawFeature","beginPath","_setStyle","_drawIcon","_drawLine","_drawPolygon","Image","p","drawImage","src","tags","j","ring","k","lineTo","moveTo","style","_setPointStyle","_setLineStyle","_setPolygonStyle","lineWidth","_setWeight","strokeStyle","_setOpacity","fillStyle","_iscolorHex","colorRgb","_colorRgb","sColor","sColorNew","slice","concat","sColorChange","parseInt","_pointInPolygon","point","vs","inside","xi","yi","xj","yj","_getLatLngsPoly","o","coordinates","_getLatLngsPoint","_getLatLngs","Array","polys","geometries","pointInLayer","first","LatLng","lng","lat","results","isPointablePixel","_popup","Popup","points","setLatLng","setContent","openOn","closePopup","geoJSON"],"mappings":"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"}